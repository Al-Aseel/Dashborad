# نظام Pagination الاحترافي لقسم الأرشيف

## نظرة عامة
تم تطوير نظام pagination احترافي لقسم الأرشيف يتضمن:
- فلتر لاختيار عدد العناصر المعروضة
- تحكم كامل في التنقل بين الصفحات
- معلومات مفصلة عن Pagination
- واجهة مستخدم محسنة

## الميزات الجديدة

### 1. فلتر عدد العناصر (Page Size Selector)
- **الخيارات المتاحة:**
  - 5 عناصر (افتراضي)
  - 10 عناصر
  - 20 عنصر
  - 30 عنصر
  - 50 عنصر
  - عرض الكل

- **الموقع:** أعلى الجدول بجانب معلومات Pagination
- **الوظيفة:** يغير عدد العناصر المعروضة في الصفحة الواحدة

### 2. معلومات Pagination المحسنة
- **عرض المعلومات:**
  - "عرض X إلى Y من أصل Z عنصر" (في header الجدول)
  - "صفحة X من Y" (في أسفل الجدول)
  - إجمالي عدد الصفحات

### 3. أزرار التحكم في Pagination
- **الموقع:** أسفل الجدول (تم نقلها من الأعلى)
- **أزرار التنقل:**
  - ⏮️ **أول صفحة:** الانتقال للصفحة الأولى
  - ◀️ **السابق:** الانتقال للصفحة السابقة
  - **أرقام الصفحات:** عرض مباشر للصفحات
  - ▶️ **التالي:** الانتقال للصفحة التالية
  - ⏭️ **آخر صفحة:** الانتقال للصفحة الأخيرة

- **عرض الصفحات:**
  - إذا كان إجمالي الصفحات ≤ 5: عرض جميع الصفحات
  - إذا كان > 5: عرض الصفحة الأولى، الأخيرة، الحالية، والصفحات المجاورة
  - إظهار "..." للصفحات المخفية

## التخطيط الجديد

### 1. تنظيم الصفحة
- **Header:** عنوان الصفحة ووصف مختصر
- **قسم البحث والفلترة:** 
  - البحث في الأعلى
  - فلتر النوع وفلتر عدد العناصر في صف واحد
- **قسم النتائج:**
  - معلومات النتائج في header الجدول
  - الجدول في المنتصف
  - أزرار التنقل في الأسفل

### 2. تحسينات التصميم
- **تخطيط منظم:** كل قسم في Card منفصل
- **معلومات واضحة:** عرض معلومات النتائج في مكانين مناسبين
- **تنقل بديهي:** أزرار التنقل في أسفل الجدول
- **تصميم متجاوب:** يعمل على جميع أحجام الشاشات

## التحديثات التقنية

### 1. إصلاح الطلبات المتعددة
- **المشكلة السابقة:** كان يتم إرسال طلبات متعددة عند تغيير الفلاتر أو Page Size
- **الحل:** تم فصل `useEffect` وإضافة `useRef` لتتبع الطلبات
- **النتيجة:** طلب واحد فقط عند تغيير أي فلتر أو بحث أو Page Size

### 2. إصلاح مشكلة Page Size
- **المشكلة السابقة:** عند تغيير Page Size كان يتم إرسال طلبين (واحد للـ Page Size وآخر للفلاتر)
- **الحل:** تم إزالة `pagination.limit` من dependencies وإزالة إعادة تعيين الفلاتر
- **النتيجة:** طلب واحد فقط عند تغيير Page Size

### 3. Hook `useArchive` المحسن
```typescript
// الدوال الجديدة المضافة
const {
  changePageSize,    // تغيير عدد العناصر
  goToPage,         // الانتقال لصفحة محددة
  goToNextPage,     // الانتقال للصفحة التالية
  goToPreviousPage, // الانتقال للصفحة السابقة
} = useArchive()
```

### 2. معالجة تغيير Page Size
```typescript
const handlePageSizeChange = async (value: string) => {
  const newLimit = parseInt(value)
  await changePageSize(newLimit === -1 ? 1000 : newLimit)
}
```

### 3. حساب معلومات العرض
```typescript
const currentPageSize = pagination.limit === 1000 ? -1 : pagination.limit
const startItem = (pagination.page - 1) * (currentPageSize === -1 ? pagination.total : currentPageSize) + 1
const endItem = Math.min(pagination.page * (currentPageSize === -1 ? pagination.total : currentPageSize), pagination.total)
```

## كيفية الاستخدام

### 1. تغيير عدد العناصر
1. انتقل لقسم الأرشيف
2. ابحث عن dropdown "عدد العناصر المعروضة" في قسم البحث والفلترة
3. اختر العدد المطلوب من القائمة
4. سيتم تحديث البيانات تلقائياً

### 2. التنقل بين الصفحات
1. استخدم أزرار التنقل في أسفل الجدول
2. انقر على رقم الصفحة المطلوبة
3. استخدم أزرار "السابق" و "التالي" للتنقل المتسلسل

### 3. دمج الفلاتر مع Pagination
- **فلتر النوع:** يعمل مع Pagination
- **البحث:** يعمل مع Pagination
- **تغيير Page Size:** يعيد تعيين الفلاتر للصفحة الأولى

## الاستجابة من الخادم

### نموذج الاستجابة
```json
{
  "status": "success",
  "message": "تم جلب العناصر المؤرشفة بنجاح",
  "data": {
    "items": [...],
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 25,
      "totalPages": 3
    }
  }
}
```

### معالجة الاستجابة
- يتم تحديث حالة Pagination تلقائياً
- يتم حساب معلومات العرض (startItem, endItem)
- يتم تحديث واجهة المستخدم

## الملفات المحدثة

### 1. `hooks/use-archive.ts`
- إضافة دوال Pagination الجديدة
- تحسين معالجة تغيير Page Size
- إضافة دوال التنقل بين الصفحات
- **تحديث القيمة الافتراضية:** من 10 إلى 5 عناصر

### 2. `app/archive/page.tsx`
- إضافة Page Size Selector
- تحسين واجهة Pagination
- إضافة معلومات Pagination المفصلة
- تحسين أزرار التنقل
- **إصلاح الطلبات المتعددة:** فصل useEffect وإضافة useRef لتتبع الطلبات
- **تحديث خيارات Page Size:** إضافة 5 عناصر كقيمة افتراضية
- **إعادة تنظيم التخطيط:** تنظيم البحث والفلترة في قسم منفصل
- **نقل أزرار التنقل:** من أعلى الجدول إلى أسفله

### 3. `lib/archive.ts`
- دعم معاملات Pagination
- معالجة الاستجابة من الخادم

## أفضل الممارسات

### 1. الأداء
- يتم إعادة تعيين الصفحة للصفحة الأولى عند تغيير Page Size
- **لا يتم إعادة تعيين الفلاتر** عند تغيير Page Size (تم إصلاح هذا)
- استخدام debouncing للبحث
- **تم إصلاح مشكلة الطلبات المتعددة** - الآن يتم إرسال طلب واحد فقط عند تغيير أي فلتر أو بحث أو Page Size

### 2. تجربة المستخدم
- عرض معلومات واضحة عن Pagination
- أزرار تنقل بديهية
- تغذية راجعة فورية للتغييرات

### 3. التوافق
- يعمل مع جميع أحجام الشاشات
- دعم كامل للغة العربية
- تصميم متجاوب

## استكشاف الأخطاء

### مشاكل شائعة
1. **لا تظهر أزرار Pagination:**
   - تأكد من أن `pagination.totalPages > 1`
   - تحقق من استجابة الخادم

2. **لا يتم تحديث البيانات:**
   - تحقق من اتصال الشبكة
   - تحقق من console للأخطاء

3. **Page Size لا يعمل:**
   - تأكد من أن الخادم يدعم معامل `limit`
   - تحقق من صحة القيمة المرسلة

### حلول
- إعادة تحميل الصفحة
- التحقق من console للأخطاء
- التأكد من صحة API endpoint

## التطوير المستقبلي

### ميزات مقترحة
1. **حفظ تفضيلات المستخدم:**
   - حفظ Page Size المفضل
   - حفظ آخر صفحة تمت زيارتها

2. **Pagination متقدم:**
   - إدخال رقم الصفحة مباشرة
   - عرض إجمالي العناصر في كل صفحة

3. **تحسينات الأداء:**
   - Virtual Scrolling للقوائم الطويلة
   - Lazy Loading للصور

## الخلاصة
تم تطوير نظام Pagination احترافي وشامل لقسم الأرشيف يوفر:
- تحكم كامل في عرض البيانات
- واجهة مستخدم بديهية
- أداء محسن
- تجربة مستخدم ممتازة

النظام جاهز للاستخدام ويدعم جميع المتطلبات المطلوبة.
